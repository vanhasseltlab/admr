% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/p_to_optim.R
\name{p_to_optim}
\alias{p_to_optim}
\title{Convert parameters to optimizable form}
\usage{
p_to_optim(p)
}
\arguments{
\item{p}{A list containing the parameter structure:
\itemize{
\item \code{beta}: Vector of population parameters (fixed effects)
e.g., clearance (CL), volume (V), absorption rate (ka)
\item \code{Omega}: Covariance matrix for random effects (between-subject variability)
diagonal elements are variances, off-diagonal are covariances
\item \code{Sigma_prop}: Proportional error variance (optional)
represents CVÂ² of residual error
\item \code{Sigma_add}: Additive error variance (optional)
represents constant error magnitude
}}
}
\value{
A list containing:
\itemize{
\item \code{values}: Vector of transformed parameter values on optimization scale
\item \code{backtransformfunc}: Function to convert optimized values back to original scale
\item \code{d_psi_d_psitrans_long}: Function for computing long-form parameter derivatives
\item \code{d_psi_d_psitrans_short}: Function for computing short-form parameter derivatives
\item \code{d_bi_d_omega}: Derivatives of random effects with respect to Omega elements
\item \code{d_omega_d_Omega}: Derivatives of transformed Omega with respect to untransformed
}
}
\description{
\code{p_to_optim} converts a parameter list into a form suitable for optimization by transforming
the parameters and computing their derivatives. This function handles the transformation of
both fixed and random effect parameters.
}
\details{
Parameter Transformations:
\itemize{
\item Population Parameters (beta):
- Log transformation for positive parameters
- Identity transformation for unrestricted parameters
- Logit transformation for parameters bounded between 0 and 1

\item Variance Components (Omega diagonal):
- Log transformation to ensure positivity
- Typically represents between-subject variability

\item Correlation Components (Omega off-diagonal):
- Inverse hyperbolic tangent (atanh) transformation
- Ensures correlations remain between -1 and 1

\item Residual Error (Sigma):
- Log transformation for variance parameters
- Handles both proportional and additive error structures
}

Derivative Computations:
\itemize{
\item First-order derivatives for optimization algorithms
\item Chain rule applied for composed transformations
\item Separate handling of variance and correlation parameters
\item Support for both dense and sparse matrices
}

Special Features:
\itemize{
\item Handles fixed parameters (specified as character strings)
\item Preserves parameter names throughout transformations
\item Automatic conversion of exponential error to proportional
\item Validates parameter values and transformations
}
}
\examples{
# Define a two-compartment model parameters
p <- list(
  # Population parameters (fixed effects)
  beta = c(cl = 5,    # Clearance (L/h)
          v1 = 10,    # Central volume (L)
          v2 = 30,    # Peripheral volume (L)
          q = 10,     # Inter-compartmental clearance (L/h)
          ka = 1),    # Absorption rate (1/h)
  
  # Between-subject variability (30\% CV on all parameters)
  Omega = matrix(c(0.09, 0, 0, 0, 0,
                  0, 0.09, 0, 0, 0,
                  0, 0, 0.09, 0, 0,
                  0, 0, 0, 0.09, 0,
                  0, 0, 0, 0, 0.09), nrow = 5, ncol = 5),
  
  # Residual error (20\% CV)
  Sigma_prop = 0.04
)

# Convert to optimization scale
p_optim <- p_to_optim(p)

# Back-transform to original scale
p_orig <- p_optim$backtransformfunc(p_optim$values)

}
