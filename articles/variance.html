<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Variance-only based modelling with admr • admr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Variance-only based modelling with admr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/admr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/examplomycin.html">Examplomycin dataset: a pharmacokinetic example</a></li>
    <li><a class="dropdown-item" href="../articles/multiple.html">Combining multiple datasets with admr</a></li>
    <li><a class="dropdown-item" href="../articles/variance.html">Variance-only based modelling with admr</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/vanhasseltlab/admr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Variance-only based modelling with admr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vanhasseltlab/admr/blob/master/vignettes/variance.Rmd" class="external-link"><code>vignettes/variance.Rmd</code></a></small>
      <div class="d-none name"><code>variance.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="variance-based-modelling">Variance based modelling<a class="anchor" aria-label="anchor" href="#variance-based-modelling"></a>
</h2>
<p>This vignette provides an introduction to variance-based modeling
using the <code>admr</code> package in R. We’ll cover the essential
steps to prepare your data, specify a pharmacokinetic model, fit the
model to aggregate data, and evaluate the results. We’ll compare the
results of using mean and variance only data to the full mean and
covariance data. Variance based modeling is particularly useful when
complex aggregate data is not available, and only means and variances
are reported.</p>
<p>The <code>admr</code> package implements the Iterative Reweighting
Monte Carlo (IRMC) algorithm, which efficiently fits models to aggregate
data by iteratively updating parameter estimates using weighted
importance sampling.</p>
<div class="section level3">
<h3 id="required-packages">Required Packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>First, we need to load the necessary packages:</p>
<details><summary>
Click here
</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vanhasseltlab.github.io/admr">admr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/rxode2/" class="external-link">rxode2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.org/" class="external-link">nlmixr2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mnorm</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>  <span class="co"># For visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-quantities.github.io/units/" class="external-link">units</a></span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="understanding-the-data-format">Understanding the Data Format<a class="anchor" aria-label="anchor" href="#understanding-the-data-format"></a>
</h3>
<p>The <code>admr</code> package works with two types of data
formats:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Raw Data</strong>: Individual-level observations in a wide
or long format.</li>
<li>
<strong>Aggregate Data</strong>: Summary statistics (mean and
covariance) computed from raw data.</li>
<li>
<strong>Aggregate Data with only means and variance</strong>: Mean
and variance for each time point (no covariances).</li>
</ol>
<p>Let’s look at the examplomycin dataset, which we’ll use throughout
this vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    ID TIME    DV AMT EVID CMT</span></span>
<span><span class="co">## 1 460 0.00 0.000 100  101   1</span></span>
<span><span class="co">## 2 460 0.10 0.752   0    0   2</span></span>
<span><span class="co">## 3 460 0.25 1.932   0    0   2</span></span>
<span><span class="co">## 4 460 0.50 3.694   0    0   2</span></span>
<span><span class="co">## 5 460 1.00 3.479   0    0   2</span></span>
<span><span class="co">## 6 460 2.00 4.003   0    0   2</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basic dataset information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of subjects:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of subjects: 500</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of time points:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">$</span><span class="va">TIME</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of time points: 10</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Time points:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">$</span><span class="va">TIME</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Time points: 0, 0.1, 0.25, 0.5, 1, 2, 3, 5, 8, 12</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<div class="section level4">
<h4 id="converting-raw-data-to-aggregate-format">Converting Raw Data to Aggregate Format<a class="anchor" aria-label="anchor" href="#converting-raw-data-to-aggregate-format"></a>
</h4>
<p>The first step is to convert our simulated raw data into aggregate
format. Then, we will create two versions of the aggregated data: one
with mean and covariance, and another with mean and variance only. In
real-world scenarios, you will not have access to the raw data, but this
step is included here for demonstration purposes.</p>
<details><summary>
Click here
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to wide format</span></span>
<span><span class="va">examplomycin_wide</span> <span class="op">&lt;-</span> <span class="va">examplomycin</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">EVID</span> <span class="op">!=</span> <span class="fl">101</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># Remove dosing events</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">TIME</span>, <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># Select relevant columns</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">TIME</span>, values_from <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># Convert to wide format</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Remove ID column</span></span>
<span></span>
<span><span class="co"># Create aggregated data</span></span>
<span><span class="va">examplomycin_aggregated</span> <span class="op">&lt;-</span> <span class="va">examplomycin_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">admr</span><span class="fu">::</span><span class="fu"><a href="../reference/meancov.html">meancov</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Compute mean and covariance</span></span>
<span></span>
<span><span class="co"># View the structure of aggregated data</span></span>
<span><span class="va">examplomycin_aggregated</span></span></code></pre></div>
<pre><code><span><span class="co">## $E</span></span>
<span><span class="co">##      0.1     0.25      0.5        1        2        3        5        8 </span></span>
<span><span class="co">## 0.966418 1.938774 2.787908 3.024706 2.257656 1.650808 1.063120 0.751180 </span></span>
<span><span class="co">##       12 </span></span>
<span><span class="co">## 0.512168 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $V</span></span>
<span><span class="co">##               0.1         0.25         0.5           1          2           3</span></span>
<span><span class="co">## 0.1   0.210318331  0.307810566  0.34863077 0.202610737 0.02244783 -0.04472722</span></span>
<span><span class="co">## 0.25  0.307810566  0.707512991  0.65887098 0.416118052 0.05871261 -0.07441765</span></span>
<span><span class="co">## 0.5   0.348630772  0.658870977  1.09983366 0.530554165 0.10572618 -0.07538386</span></span>
<span><span class="co">## 1     0.202610737  0.416118052  0.53055416 0.803744604 0.16252833  0.02792441</span></span>
<span><span class="co">## 2     0.022447834  0.058712608  0.10572618 0.162528331 0.34465070  0.12026872</span></span>
<span><span class="co">## 3    -0.044727222 -0.074417647 -0.07538386 0.027924410 0.12026872  0.24989260</span></span>
<span><span class="co">## 5    -0.018976800 -0.042420657 -0.04648286 0.001618855 0.07644080  0.11148574</span></span>
<span><span class="co">## 8    -0.006630907 -0.011273701 -0.01981830 0.016197981 0.06398700  0.07493319</span></span>
<span><span class="co">## 12   -0.005625994 -0.005018766 -0.01492001 0.014748325 0.04941463  0.05460018</span></span>
<span><span class="co">##                 5            8           12</span></span>
<span><span class="co">## 0.1  -0.018976800 -0.006630907 -0.005625994</span></span>
<span><span class="co">## 0.25 -0.042420657 -0.011273701 -0.005018766</span></span>
<span><span class="co">## 0.5  -0.046482865 -0.019818299 -0.014920009</span></span>
<span><span class="co">## 1     0.001618855  0.016197981  0.014748325</span></span>
<span><span class="co">## 2     0.076440801  0.063987002  0.049414630</span></span>
<span><span class="co">## 3     0.111485737  0.074933189  0.054600176</span></span>
<span><span class="co">## 5     0.154215442  0.087680168  0.061332530</span></span>
<span><span class="co">## 8     0.087680168  0.096530356  0.057621124</span></span>
<span><span class="co">## 12    0.061332530  0.057621124  0.057988752</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform into mean and variance only format</span></span>
<span><span class="va">examplomycin_aggregated_var</span> <span class="op">&lt;-</span> <span class="va">examplomycin_aggregated</span></span>
<span><span class="va">examplomycin_aggregated_var</span><span class="op">$</span><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">examplomycin_aggregated_var</span><span class="op">$</span><span class="va">V</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the structure of mean and variance only data</span></span>
<span><span class="va">examplomycin_aggregated_var</span></span></code></pre></div>
<pre><code><span><span class="co">## $E</span></span>
<span><span class="co">##      0.1     0.25      0.5        1        2        3        5        8 </span></span>
<span><span class="co">## 0.966418 1.938774 2.787908 3.024706 2.257656 1.650808 1.063120 0.751180 </span></span>
<span><span class="co">##       12 </span></span>
<span><span class="co">## 0.512168 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $V</span></span>
<span><span class="co">##            [,1]     [,2]     [,3]      [,4]      [,5]      [,6]      [,7]</span></span>
<span><span class="co">##  [1,] 0.2103183 0.000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">##  [2,] 0.0000000 0.707513 0.000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">##  [3,] 0.0000000 0.000000 1.099834 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">##  [4,] 0.0000000 0.000000 0.000000 0.8037446 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">##  [5,] 0.0000000 0.000000 0.000000 0.0000000 0.3446507 0.0000000 0.0000000</span></span>
<span><span class="co">##  [6,] 0.0000000 0.000000 0.000000 0.0000000 0.0000000 0.2498926 0.0000000</span></span>
<span><span class="co">##  [7,] 0.0000000 0.000000 0.000000 0.0000000 0.0000000 0.0000000 0.1542154</span></span>
<span><span class="co">##  [8,] 0.0000000 0.000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">##  [9,] 0.0000000 0.000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">##             [,8]       [,9]</span></span>
<span><span class="co">##  [1,] 0.00000000 0.00000000</span></span>
<span><span class="co">##  [2,] 0.00000000 0.00000000</span></span>
<span><span class="co">##  [3,] 0.00000000 0.00000000</span></span>
<span><span class="co">##  [4,] 0.00000000 0.00000000</span></span>
<span><span class="co">##  [5,] 0.00000000 0.00000000</span></span>
<span><span class="co">##  [6,] 0.00000000 0.00000000</span></span>
<span><span class="co">##  [7,] 0.00000000 0.00000000</span></span>
<span><span class="co">##  [8,] 0.09653036 0.00000000</span></span>
<span><span class="co">##  [9,] 0.00000000 0.05798875</span></span></code></pre>
</details>
</div>
<div class="section level4">
<h4 id="visualizing-the-data">Visualizing the Data<a class="anchor" aria-label="anchor" href="#visualizing-the-data"></a>
</h4>
<p>Before fitting the model, it’s helpful to visualize the data:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Boxplot to visualize variability</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">examplomycin</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span>, group <span class="op">=</span> <span class="va">TIME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">TIME</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Concentration Variability at Each Time Point"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time (hours)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Concentration (mg/L)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="variance_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="model-specification">Model Specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h3>
<div class="section level4">
<h4 id="defining-the-pharmacokinetic-model">Defining the Pharmacokinetic Model<a class="anchor" aria-label="anchor" href="#defining-the-pharmacokinetic-model"></a>
</h4>
<p>We’ll use a solved two-compartment model with first-order
absorption:</p>
<details><summary>
Click here
</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define RxODE model</span></span>
<span><span class="va">rxModel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cp</span> <span class="op">=</span> <span class="fu">linCmt</span><span class="op">(</span></span>
<span>      <span class="va">cl</span>,           <span class="co"># Clearance</span></span>
<span>      <span class="va">v1</span>,           <span class="co"># Volume of central compartment</span></span>
<span>      <span class="va">v2</span>,           <span class="co"># Volume of peripheral compartment</span></span>
<span>      <span class="va">q</span>,            <span class="co"># Inter-compartmental clearance</span></span>
<span>      <span class="va">ka</span>            <span class="co"># Absorption rate constant</span></span>
<span>    <span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rxModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxode2.html" class="external-link">rxode2</a></span><span class="op">(</span><span class="va">rxModel</span><span class="op">)</span></span>
<span><span class="va">rxModel</span> <span class="op">&lt;-</span> <span class="va">rxModel</span><span class="op">$</span><span class="va">simulationModel</span></span></code></pre></div>
</details>
</div>
<div class="section level4">
<h4 id="creating-the-prediction-function">Creating the Prediction Function<a class="anchor" aria-label="anchor" href="#creating-the-prediction-function"></a>
</h4>
<p>The prediction function is crucial for the <code>admr</code> package.
It: - Constructs the event table for dosing and sampling - Solves the
RxODE model - Returns predicted concentrations in the required
format</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rxode2</span><span class="fu">::</span><span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSetSilentErr.html" class="external-link">rxSetSilentErr</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predder</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">theta_i</span>, <span class="va">dose</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n_individuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">theta_i</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">n_individuals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">n_individuals</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Create event table</span></span>
<span>    <span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/eventTable.html" class="external-link">eventTable</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span></span>
<span>    <span class="va">ev</span><span class="op">$</span><span class="fu">add.dosing</span><span class="op">(</span>dose <span class="op">=</span> <span class="va">dose</span>, nbr.doses <span class="op">=</span> <span class="fl">1</span>, start.time <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">ev</span><span class="op">$</span><span class="fu">add.sampling</span><span class="op">(</span><span class="va">time</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Solve model</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">rxModel</span>, params <span class="op">=</span> <span class="va">theta_i</span>, events <span class="op">=</span> <span class="va">ev</span>, cores <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Format output</span></span>
<span>    <span class="va">cp_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">cp</span>, nrow <span class="op">=</span> <span class="va">n_individuals</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, </span>
<span>                        byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cp_matrix</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>It can be observed that all steps for variance based modeling are
similar to the mean and covariance based modeling. The only difference
is in the data that is used for fitting the model.</p>
</div>
</div>
<div class="section level3">
<h3 id="model-fitting">Model Fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<div class="section level4">
<h4 id="setting-up-model-options">Setting Up Model Options<a class="anchor" aria-label="anchor" href="#setting-up-model-options"></a>
</h4>
<p>The <code>genopts</code> function creates an options object that
controls the model fitting process. We’ll do this twice: once for mean
and covariance data, and once for mean and variance only data.</p>
<details><summary>
Click here
</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opts_covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genopts.html">genopts</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">12</span><span class="op">)</span>,  <span class="co"># Observation times</span></span>
<span>  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="fl">5</span>, v1 <span class="op">=</span> <span class="fl">10</span>, v2 <span class="op">=</span> <span class="fl">30</span>, q <span class="op">=</span> <span class="fl">10</span>, ka <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Population parameters</span></span>
<span>    Omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,  <span class="co"># Random effects</span></span>
<span>    Sigma_prop <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Proportional error</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10000</span>,  <span class="co"># Number of Monte Carlo samples</span></span>
<span>  n <span class="op">=</span> <span class="fl">500</span>,      <span class="co"># Number of individuals</span></span>
<span>  fo_appr <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Disable first-order approximation</span></span>
<span>  omega_expansion <span class="op">=</span> <span class="fl">1</span>,  <span class="co"># Omega expansion factor</span></span>
<span>  f <span class="op">=</span> <span class="va">predder</span>,    <span class="co"># Prediction function</span></span>
<span>  no_cov <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Use mean and covariance format</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">opts_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genopts.html">genopts</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">12</span><span class="op">)</span>,  <span class="co"># Observation times</span></span>
<span>  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="fl">5</span>, v1 <span class="op">=</span> <span class="fl">10</span>, v2 <span class="op">=</span> <span class="fl">30</span>, q <span class="op">=</span> <span class="fl">10</span>, ka <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Population parameters</span></span>
<span>    Omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,  <span class="co"># Random effects</span></span>
<span>    Sigma_prop <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Proportional error</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10000</span>,  <span class="co"># Number of Monte Carlo samples</span></span>
<span>  n <span class="op">=</span> <span class="fl">500</span>,      <span class="co"># Number of individuals</span></span>
<span>  fo_appr <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Disable first-order approximation</span></span>
<span>  omega_expansion <span class="op">=</span> <span class="fl">1</span>,  <span class="co"># Omega expansion factor</span></span>
<span>  f <span class="op">=</span> <span class="va">predder</span>,    <span class="co"># Prediction function</span></span>
<span>  no_cov <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># Use mean and variance only format</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>The only difference between the two options is the
<code>no_cov</code> argument, which is set to <code>TRUE</code> for
variance only data and <code>FALSE</code> for mean and covariance
data.</p>
</div>
<div class="section level4">
<h4 id="fitting-the-model">Fitting the Model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h4>
<p>The <code>fitIRMC</code> function fits the model using the IRMC
algorithm:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.var</span> <span class="op">&lt;-</span> <span class="fu">admr</span><span class="fu">::</span><span class="fu"><a href="../reference/fitIRMC.html">fitIRMC</a></span><span class="op">(</span></span>
<span>  opts <span class="op">=</span> <span class="va">opts_var</span>,</span>
<span>  obs <span class="op">=</span> <span class="va">examplomycin_aggregated_var</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">3</span>,  <span class="co"># Number of chains</span></span>
<span>  maxiter <span class="op">=</span> <span class="fl">200</span>  <span class="co"># Maximum iterations</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Chain 1:</span></span>
<span><span class="co">## Iter | NLL and Parameters (11 values)</span></span>
<span><span class="co">## --------------------------------------------------------------------------------</span></span>
<span><span class="co">##    1: -1242.386    1.609    2.303    3.401    2.303    0.000   -2.408   -2.408   -2.408   -2.408   -2.408   -3.219</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Wide Search Phase ###</span></span>
<span><span class="co">##    2: -1261.650    1.593    2.057    3.463    2.177   -0.260   -2.086   -2.747   -2.350   -4.408   -1.915   -3.387</span></span>
<span><span class="co">##    3: -1266.443    1.597    2.050    3.458    2.171   -0.246   -2.137   -2.683   -2.379   -5.410   -2.013   -3.368</span></span>
<span><span class="co">##    4: -1266.455    1.597    2.051    3.457    2.173   -0.245   -2.137   -2.681   -2.379   -5.422   -2.015   -3.360</span></span>
<span><span class="co">## Phase Wide Search Phase converged at iteration 4.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Focussed Search Phase ###</span></span>
<span><span class="co">##    5: -1266.455    1.598    2.052    3.456    2.172   -0.244   -2.135   -2.677   -2.382   -5.434   -2.015   -3.362</span></span>
<span><span class="co">##    6: -1266.456    1.598    2.052    3.456    2.172   -0.244   -2.135   -2.677   -2.382   -5.444   -2.015   -3.362</span></span>
<span><span class="co">##    7: -1266.456    1.598    2.052    3.456    2.172   -0.244   -2.135   -2.677   -2.382   -5.454   -2.015   -3.362</span></span>
<span><span class="co">##    8: -1266.456    1.598    2.052    3.456    2.172   -0.244   -2.135   -2.677   -2.382   -5.464   -2.015   -3.362</span></span>
<span><span class="co">##    9: -1266.456    1.598    2.052    3.456    2.172   -0.244   -2.135   -2.676   -2.382   -5.474   -2.015   -3.362</span></span>
<span><span class="co">##   10: -1266.456    1.598    2.052    3.456    2.172   -0.244   -2.135   -2.676   -2.382   -5.479   -2.015   -3.362</span></span>
<span><span class="co">##   11: -1266.456    1.598    2.052    3.456    2.172   -0.244   -2.135   -2.676   -2.382   -5.484   -2.015   -3.362</span></span>
<span><span class="co">##   12: -1266.456    1.598    2.052    3.456    2.172   -0.244   -2.135   -2.676   -2.383   -5.489   -2.015   -3.362</span></span>
<span><span class="co">##   13: -1266.456    1.598    2.052    3.456    2.172   -0.244   -2.135   -2.676   -2.383   -5.488   -2.016   -3.361</span></span>
<span><span class="co">## Phase Focussed Search Phase converged at iteration 13.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Fine-Tuning Phase ###</span></span>
<span><span class="co">##   14: -1266.456    1.598    2.052    3.456    2.172   -0.244   -2.136   -2.675   -2.384   -5.490   -2.016   -3.360</span></span>
<span><span class="co">## Phase Fine-Tuning Phase converged at iteration 14.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Precision Phase ###</span></span>
<span><span class="co">##   15: -1266.456    1.598    2.054    3.455    2.173   -0.242   -2.136   -2.668   -2.388   -5.480   -2.019   -3.358</span></span>
<span><span class="co">##   16: -1266.456    1.598    2.054    3.455    2.173   -0.242   -2.136   -2.669   -2.388   -5.480   -2.019   -3.358</span></span>
<span><span class="co">## Phase Precision Phase converged at iteration 16.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 Complete: Final NLL = -1266.456, Time Elapsed = 31.81 seconds</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Phase Focussed Search Phase converged at iteration 120.</span></span>
<span><span class="co">## Phase Fine-Tuning Phase converged at iteration 121.</span></span>
<span><span class="co">## Phase Precision Phase converged at iteration 143.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 2 Complete: Final NLL = -1266.456, Time Elapsed = 171.47 seconds</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Phase Wide Search Phase converged at iteration 10.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 3 Complete: Final NLL = -1266.107, Time Elapsed = 240.36 seconds</span></span>
<span><span class="co">## </span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.covar</span> <span class="op">&lt;-</span> <span class="fu">admr</span><span class="fu">::</span><span class="fu"><a href="../reference/fitIRMC.html">fitIRMC</a></span><span class="op">(</span></span>
<span>  opts <span class="op">=</span> <span class="va">opts_covar</span>,</span>
<span>  obs <span class="op">=</span> <span class="va">examplomycin_aggregated</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">3</span>,  <span class="co"># Number of chains</span></span>
<span>  maxiter <span class="op">=</span> <span class="fl">200</span>  <span class="co"># Maximum iterations</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Chain 1:</span></span>
<span><span class="co">## Iter | NLL and Parameters (11 values)</span></span>
<span><span class="co">## --------------------------------------------------------------------------------</span></span>
<span><span class="co">##    1: -1839.520    1.609    2.303    3.401    2.303    0.000   -2.408   -2.408   -2.408   -2.408   -2.408   -3.219</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Wide Search Phase ###</span></span>
<span><span class="co">##    2: -1845.312    1.601    2.323    3.399    2.285    0.032   -2.274   -2.186   -2.325   -2.213   -2.412   -3.235</span></span>
<span><span class="co">##    3: -1845.355    1.601    2.317    3.401    2.285    0.027   -2.283   -2.217   -2.339   -2.238   -2.388   -3.235</span></span>
<span><span class="co">##    4: -1845.355    1.601    2.317    3.401    2.285    0.027   -2.282   -2.216   -2.340   -2.237   -2.388   -3.235</span></span>
<span><span class="co">##    5: -1845.354    1.601    2.317    3.401    2.285    0.027   -2.282   -2.216   -2.340   -2.236   -2.389   -3.235</span></span>
<span><span class="co">##    6: -1845.354    1.601    2.317    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.389   -3.235</span></span>
<span><span class="co">##    7: -1845.354    1.601    2.317    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.389   -3.235</span></span>
<span><span class="co">## Phase Wide Search Phase converged at iteration 7.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Focussed Search Phase ###</span></span>
<span><span class="co">##    8: -1845.355    1.601    2.317    3.401    2.285    0.026   -2.282   -2.217   -2.338   -2.237   -2.388   -3.235</span></span>
<span><span class="co">##    9: -1845.354    1.601    2.318    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.389   -3.235</span></span>
<span><span class="co">##   10: -1845.354    1.601    2.318    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.389   -3.235</span></span>
<span><span class="co">##   11: -1845.354    1.601    2.318    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.389   -3.235</span></span>
<span><span class="co">## Phase Focussed Search Phase converged at iteration 11.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Fine-Tuning Phase ###</span></span>
<span><span class="co">##   12: -1845.354    1.601    2.318    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.390   -3.235</span></span>
<span><span class="co">##   13: -1845.354    1.601    2.318    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.390   -3.235</span></span>
<span><span class="co">##   14: -1845.354    1.601    2.318    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.390   -3.235</span></span>
<span><span class="co">## Phase Fine-Tuning Phase converged at iteration 14.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Precision Phase ###</span></span>
<span><span class="co">##   15: -1845.354    1.601    2.318    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.390   -3.235</span></span>
<span><span class="co">##   16: -1845.354    1.601    2.318    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.389   -3.235</span></span>
<span><span class="co">##   17: -1845.354    1.601    2.318    3.401    2.285    0.027   -2.282   -2.216   -2.339   -2.236   -2.389   -3.235</span></span>
<span><span class="co">## Phase Precision Phase converged at iteration 17.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 Complete: Final NLL = -1845.355, Time Elapsed = 15.95 seconds</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Phase Wide Search Phase converged at iteration 13.</span></span>
<span><span class="co">## Phase Focussed Search Phase converged at iteration 15.</span></span>
<span><span class="co">## Phase Fine-Tuning Phase converged at iteration 16.</span></span>
<span><span class="co">## Phase Precision Phase converged at iteration 18.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 2 Complete: Final NLL = -1845.354, Time Elapsed = 21.09 seconds</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Phase Wide Search Phase converged at iteration 8.</span></span>
<span><span class="co">## Phase Focussed Search Phase converged at iteration 10.</span></span>
<span><span class="co">## Phase Fine-Tuning Phase converged at iteration 11.</span></span>
<span><span class="co">## Phase Precision Phase converged at iteration 13.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 3 Complete: Final NLL = -1845.354, Time Elapsed = 14.45 seconds</span></span>
<span><span class="co">## </span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="model-diagnostics">Model Diagnostics<a class="anchor" aria-label="anchor" href="#model-diagnostics"></a>
</h3>
<div class="section level4">
<h4 id="basic-diagnostics">Basic Diagnostics<a class="anchor" aria-label="anchor" href="#basic-diagnostics"></a>
</h4>
<p>The <code>print</code> method provides a summary of the model
fit:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.var</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## -- FitIRMC Summary --</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Objective Function and Information Criteria --</span></span>
<span><span class="co">##  Log-likelihood: -1266.4561</span></span>
<span><span class="co">##             AIC: 2543.91</span></span>
<span><span class="co">##             BIC: 2601.27</span></span>
<span><span class="co">## Condition#(Cov): 489.08</span></span>
<span><span class="co">## Condition#(Cor): 695.66</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Timing Information --</span></span>
<span><span class="co">##      Best Chain: 31.8088 seconds</span></span>
<span><span class="co">##      All Chains: 443.6457 seconds</span></span>
<span><span class="co">##      Covariance: 23.0615 seconds</span></span>
<span><span class="co">##         Elapsed: 466.71 seconds</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Population Parameters --</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">##   Parameter         Est.      SE `%RSE` `Back-transformed(95%CI)` `BSV(CV%)`</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> cl              1.60    0.015<span style="text-decoration: underline;">8</span>  0.986 4.94 (4.79, 5.10)              34.4 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> v1              2.05    0.079<span style="text-decoration: underline;">4</span>  3.87  7.80 (6.68, 9.12)              26.3 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> v2              3.46    0.038<span style="text-decoration: underline;">9</span>  1.12  31.66 (29.34, 34.17)           30.3 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> q               2.17    0.028<span style="text-decoration: underline;">4</span>  1.31  8.79 (8.31, 9.29)               6.46</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> ka             -<span style="color: #BB0000;">0.242</span>   0.073<span style="text-decoration: underline;">7</span> 30.5   0.79 (0.68, 0.91)              36.4 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Residual Error  0.034<span style="text-decoration: underline;">8</span> <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     0.0348                         <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Iteration Diagnostics --</span></span>
<span><span class="co">##  Iter | NLL and Parameters</span></span>
<span><span class="co">## --------------------------------------------------------------------------------</span></span>
<span><span class="co">##    1: -1242.386 1.609 2.303 3.401 2.303 0.000 -2.408 -2.408 -2.408 -2.408 -2.408 -3.219</span></span>
<span><span class="co">##    2: -1261.650 1.593 2.057 3.463 2.177 -0.260 -2.086 -2.747 -2.350 -4.408 -1.915 -3.387</span></span>
<span><span class="co">##    3: -1266.443 1.597 2.050 3.458 2.171 -0.246 -2.137 -2.683 -2.379 -5.410 -2.013 -3.368</span></span>
<span><span class="co">##    4: -1266.455 1.597 2.051 3.457 2.173 -0.245 -2.137 -2.681 -2.379 -5.422 -2.015 -3.360</span></span>
<span><span class="co">##    5: -1266.455 1.598 2.052 3.456 2.172 -0.244 -2.135 -2.677 -2.382 -5.434 -2.015 -3.362</span></span>
<span><span class="co">##    ... (omitted iterations) ...</span></span>
<span><span class="co">##   12: -1266.456 1.598 2.052 3.456 2.172 -0.244 -2.135 -2.676 -2.383 -5.489 -2.015 -3.362</span></span>
<span><span class="co">##   13: -1266.456 1.598 2.052 3.456 2.172 -0.244 -2.135 -2.676 -2.383 -5.488 -2.016 -3.361</span></span>
<span><span class="co">##   14: -1266.456 1.598 2.052 3.456 2.172 -0.244 -2.136 -2.675 -2.384 -5.490 -2.016 -3.360</span></span>
<span><span class="co">##   15: -1266.456 1.598 2.054 3.455 2.173 -0.242 -2.136 -2.668 -2.388 -5.480 -2.019 -3.358</span></span>
<span><span class="co">##   16: -1266.456 1.598 2.054 3.455 2.173 -0.242 -2.136 -2.669 -2.388 -5.480 -2.019 -3.358</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.covar</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## -- FitIRMC Summary --</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Objective Function and Information Criteria --</span></span>
<span><span class="co">##  Log-likelihood: -1845.3550</span></span>
<span><span class="co">##             AIC: 3701.71</span></span>
<span><span class="co">##             BIC: 3759.07</span></span>
<span><span class="co">## Condition#(Cov): 152.22</span></span>
<span><span class="co">## Condition#(Cor): 216.91</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Timing Information --</span></span>
<span><span class="co">##      Best Chain: 15.9506 seconds</span></span>
<span><span class="co">##      All Chains: 51.4956 seconds</span></span>
<span><span class="co">##      Covariance: 23.1620 seconds</span></span>
<span><span class="co">##         Elapsed: 74.66 seconds</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Population Parameters --</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">##   Parameter        Est.      SE  `%RSE` `Back-transformed(95%CI)` `BSV(CV%)`</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> cl             1.60    0.015<span style="text-decoration: underline;">2</span>   0.950 4.96 (4.81, 5.11)               31.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> v1             2.32    0.086<span style="text-decoration: underline;">5</span>   3.73  10.15 (8.57, 12.02)             33.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> v2             3.40    0.040<span style="text-decoration: underline;">0</span>   1.18  30.00 (27.74, 32.45)            31.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> q              2.29    0.021<span style="text-decoration: underline;">2</span>   0.928 9.83 (9.43, 10.24)              32.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> ka             0.026<span style="text-decoration: underline;">5</span>  0.081<span style="text-decoration: underline;">7</span> 308.    1.03 (0.87, 1.21)               30.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Residual Error 0.039<span style="text-decoration: underline;">4</span> <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>     0.0394                          <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Iteration Diagnostics --</span></span>
<span><span class="co">##  Iter | NLL and Parameters</span></span>
<span><span class="co">## --------------------------------------------------------------------------------</span></span>
<span><span class="co">##    1: -1839.520 1.609 2.303 3.401 2.303 0.000 -2.408 -2.408 -2.408 -2.408 -2.408 -3.219</span></span>
<span><span class="co">##    2: -1845.312 1.601 2.323 3.399 2.285 0.032 -2.274 -2.186 -2.325 -2.213 -2.412 -3.235</span></span>
<span><span class="co">##    3: -1845.355 1.601 2.317 3.401 2.285 0.027 -2.283 -2.217 -2.339 -2.238 -2.388 -3.235</span></span>
<span><span class="co">##    4: -1845.355 1.601 2.317 3.401 2.285 0.027 -2.282 -2.216 -2.340 -2.237 -2.388 -3.235</span></span>
<span><span class="co">##    5: -1845.354 1.601 2.317 3.401 2.285 0.027 -2.282 -2.216 -2.340 -2.236 -2.389 -3.235</span></span>
<span><span class="co">##    ... (omitted iterations) ...</span></span>
<span><span class="co">##   13: -1845.354 1.601 2.318 3.401 2.285 0.027 -2.282 -2.216 -2.339 -2.236 -2.390 -3.235</span></span>
<span><span class="co">##   14: -1845.354 1.601 2.318 3.401 2.285 0.027 -2.282 -2.216 -2.339 -2.236 -2.390 -3.235</span></span>
<span><span class="co">##   15: -1845.354 1.601 2.318 3.401 2.285 0.027 -2.282 -2.216 -2.339 -2.236 -2.390 -3.235</span></span>
<span><span class="co">##   16: -1845.354 1.601 2.318 3.401 2.285 0.027 -2.282 -2.216 -2.339 -2.236 -2.389 -3.235</span></span>
<span><span class="co">##   17: -1845.354 1.601 2.318 3.401 2.285 0.027 -2.282 -2.216 -2.339 -2.236 -2.389 -3.235</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="convergence-assessment">Convergence Assessment<a class="anchor" aria-label="anchor" href="#convergence-assessment"></a>
</h4>
<p>The <code>plot</code> method visualizes the convergence of the model
fit:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.var</span><span class="op">)</span></span></code></pre></div>
<p><img src="variance_files/figure-html/unnamed-chunk-9-1.png" width="700"><img src="variance_files/figure-html/unnamed-chunk-9-2.png" width="700"><img src="variance_files/figure-html/unnamed-chunk-9-3.png" width="700"><img src="variance_files/figure-html/unnamed-chunk-9-4.png" width="700"><img src="variance_files/figure-html/unnamed-chunk-9-5.png" width="700">
First variance only data is plotted. We see that the model converges
well within the specified iterations. Now we plot the mean and
covariance data fit:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.covar</span><span class="op">)</span></span></code></pre></div>
<p><img src="variance_files/figure-html/unnamed-chunk-10-1.png" width="700"><img src="variance_files/figure-html/unnamed-chunk-10-2.png" width="700"><img src="variance_files/figure-html/unnamed-chunk-10-3.png" width="700"><img src="variance_files/figure-html/unnamed-chunk-10-4.png" width="700"><img src="variance_files/figure-html/unnamed-chunk-10-5.png" width="700">
This data seems to converge slightly better, especially when looking at
chain comparisons. All chains converge to similar values, whereas in the
variance only data, the chains show more variability while resulting in
the same NLL. This is due to non-identifiability issues of some
parameters when only variance data is used.</p>
</div>
<div class="section level4">
<h4 id="true-vs-estimated-parameters">True vs Estimated Parameters<a class="anchor" aria-label="anchor" href="#true-vs-estimated-parameters"></a>
</h4>
<p>Given that true parameter estimates are known, we can compare the
estimated parameters to the true values:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params.true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="fl">5</span>, v1 <span class="op">=</span> <span class="fl">10</span>, v2 <span class="op">=</span> <span class="fl">30</span>, q <span class="op">=</span> <span class="fl">10</span>, ka <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  Omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Sigma_prop <span class="op">=</span> <span class="fl">0.04</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"True parameter values:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## True parameter values:</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">params.true</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $beta</span></span>
<span><span class="co">## cl v1 v2  q ka </span></span>
<span><span class="co">##  5 10 30 10  1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Omega</span></span>
<span><span class="co">##      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">## [1,] 0.09 0.00 0.00 0.00 0.00</span></span>
<span><span class="co">## [2,] 0.00 0.09 0.00 0.00 0.00</span></span>
<span><span class="co">## [3,] 0.00 0.00 0.09 0.00 0.00</span></span>
<span><span class="co">## [4,] 0.00 0.00 0.00 0.09 0.00</span></span>
<span><span class="co">## [5,] 0.00 0.00 0.00 0.00 0.09</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Sigma_prop</span></span>
<span><span class="co">## [1] 0.04</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (mean and variance only):\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Estimated parameters (mean and variance only):</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.var</span><span class="op">$</span><span class="va">transformed_params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $beta</span></span>
<span><span class="co">##         cl         v1         v2          q         ka </span></span>
<span><span class="co">##  4.9426945  7.8010034 31.6642476  8.7855438  0.7850831 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Omega</span></span>
<span><span class="co">##           [,1]       [,2]       [,3]        [,4]     [,5]</span></span>
<span><span class="co">## [1,] 0.1181541 0.00000000 0.00000000 0.000000000 0.000000</span></span>
<span><span class="co">## [2,] 0.0000000 0.06934149 0.00000000 0.000000000 0.000000</span></span>
<span><span class="co">## [3,] 0.0000000 0.00000000 0.09179961 0.000000000 0.000000</span></span>
<span><span class="co">## [4,] 0.0000000 0.00000000 0.00000000 0.004168057 0.000000</span></span>
<span><span class="co">## [5,] 0.0000000 0.00000000 0.00000000 0.000000000 0.132778</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Sigma_prop</span></span>
<span><span class="co">## [1] 0.03479938</span></span></code></pre>
<p>We observe that both methods recover the true parameters reasonably
well, but the mean and covariance method provides more accurate
estimates due to the additional information from covariances. In this
example model, especially inter-compartmental clearance (q) and its
random effect are more challenging to estimate accurately with only
variance data. However, using larger sample sizes from more studies will
help improve the estimates from both data. To further illustrate the
differences in dynamics, we can simulate concentration-time profiles
using the true parameters and the estimated parameters from both
methods.</p>
</div>
<div class="section level4">
<h4 id="dosing-plot-with-confidence-intervals-for-true-vs-estimated-parameters">Dosing plot with Confidence Intervals for true vs estimated
parameters<a class="anchor" aria-label="anchor" href="#dosing-plot-with-confidence-intervals-for-true-vs-estimated-parameters"></a>
</h4>
<p>Let’s simulate concentration-time profiles using the true parameters
and the estimated parameters from both methods, and then plot the
results with confidence intervals. First, we define the models using the
true parameters and the estimated parameters from both methods:</p>
<details><summary>
Click here
</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params.true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="fl">5</span>, v1 <span class="op">=</span> <span class="fl">10</span>, v2 <span class="op">=</span> <span class="fl">30</span>, q <span class="op">=</span> <span class="fl">10</span>, ka <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  Omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Sigma_prop <span class="op">=</span> <span class="fl">0.04</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">params.covar</span> <span class="op">&lt;-</span> <span class="va">fit.covar</span><span class="op">$</span><span class="va">transformed_params</span></span>
<span><span class="va">params.var</span> <span class="op">&lt;-</span> <span class="va">fit.var</span><span class="op">$</span><span class="va">transformed_params</span></span>
<span></span>
<span><span class="va">rxModel_true</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"cl"</span><span class="op">]</span>  <span class="co"># Clearance</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v1"</span><span class="op">]</span>  <span class="co"># Volume of central compartment</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v2"</span><span class="op">]</span> <span class="co"># Volume of peripheral compartment</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"q"</span><span class="op">]</span>    <span class="co"># Inter-compartmental clearance</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"ka"</span><span class="op">]</span>   <span class="co"># Absorption rate constant</span></span>
<span></span>
<span>    <span class="va">eta_cl</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">eta_v1</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">eta_v2</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">eta_q</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">]</span></span>
<span>    <span class="va">eta_ka</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">cl</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_cl</span><span class="op">)</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">v1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v1</span><span class="op">)</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">v2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v2</span><span class="op">)</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_q</span><span class="op">)</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">ka</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_ka</span><span class="op">)</span></span>
<span>    <span class="va">cp</span> <span class="op">=</span> <span class="fu">linCmt</span><span class="op">(</span><span class="va">cl</span>, <span class="va">v1</span>, <span class="va">v2</span>, <span class="va">q</span>, <span class="va">ka</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">rxModel_covar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"cl"</span><span class="op">]</span>  <span class="co"># Clearance</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v1"</span><span class="op">]</span>  <span class="co"># Volume of central compartment</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v2"</span><span class="op">]</span> <span class="co"># Volume of peripheral compartment</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"q"</span><span class="op">]</span>    <span class="co"># Inter-compartmental clearance</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"ka"</span><span class="op">]</span>   <span class="co"># Absorption rate constant</span></span>
<span></span>
<span>    <span class="va">eta_cl</span> <span class="op">~</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">eta_v1</span> <span class="op">~</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">eta_v2</span> <span class="op">~</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">eta_q</span> <span class="op">~</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">]</span></span>
<span>    <span class="va">eta_ka</span> <span class="op">~</span> <span class="va">params.covar</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">cl</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_cl</span><span class="op">)</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">v1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v1</span><span class="op">)</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">v2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v2</span><span class="op">)</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_q</span><span class="op">)</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">ka</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_ka</span><span class="op">)</span></span>
<span>    <span class="va">cp</span> <span class="op">=</span> <span class="fu">linCmt</span><span class="op">(</span><span class="va">cl</span>, <span class="va">v1</span>, <span class="va">v2</span>, <span class="va">q</span>, <span class="va">ka</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">rxModel_var</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">params.var</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"cl"</span><span class="op">]</span>  <span class="co"># Clearance</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">params.var</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v1"</span><span class="op">]</span>  <span class="co"># Volume of central compartment</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">params.var</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v2"</span><span class="op">]</span> <span class="co"># Volume of peripheral compartment</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">params.var</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"q"</span><span class="op">]</span>    <span class="co"># Inter-compartmental clearance</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">params.var</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"ka"</span><span class="op">]</span>   <span class="co"># Absorption rate constant</span></span>
<span></span>
<span>    <span class="va">eta_cl</span> <span class="op">~</span> <span class="va">params.var</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">eta_v1</span> <span class="op">~</span> <span class="va">params.var</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">eta_v2</span> <span class="op">~</span> <span class="va">params.var</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">eta_q</span> <span class="op">~</span> <span class="va">params.var</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">]</span></span>
<span>    <span class="va">eta_ka</span> <span class="op">~</span> <span class="va">params.var</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">cl</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_cl</span><span class="op">)</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">v1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v1</span><span class="op">)</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">v2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v2</span><span class="op">)</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_q</span><span class="op">)</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">ka</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_ka</span><span class="op">)</span></span>
<span>    <span class="va">cp</span> <span class="op">=</span> <span class="fu">linCmt</span><span class="op">(</span><span class="va">cl</span>, <span class="va">v1</span>, <span class="va">v2</span>, <span class="va">q</span>, <span class="va">ka</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rxModel_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxode2.html" class="external-link">rxode2</a></span><span class="op">(</span><span class="fu">rxModel_true</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rxModel_true</span> <span class="op">&lt;-</span> <span class="va">rxModel_true</span><span class="op">$</span><span class="va">simulationModel</span></span>
<span><span class="va">rxModel_covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxode2.html" class="external-link">rxode2</a></span><span class="op">(</span><span class="fu">rxModel_covar</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rxModel_covar</span> <span class="op">&lt;-</span> <span class="va">rxModel_covar</span><span class="op">$</span><span class="va">simulationModel</span></span>
<span><span class="va">rxModel_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxode2.html" class="external-link">rxode2</a></span><span class="op">(</span><span class="fu">rxModel_var</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rxModel_var</span> <span class="op">&lt;-</span> <span class="va">rxModel_var</span><span class="op">$</span><span class="va">simulationModel</span></span></code></pre></div>
</details><p>Now we can simulate the concentration-time profiles and plot the
results:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>  <span class="co"># Dense time points for smooth curves</span></span>
<span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/eventTable.html" class="external-link">eventTable</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span></span>
<span><span class="va">ev</span><span class="op">$</span><span class="fu">add.dosing</span><span class="op">(</span>dose <span class="op">=</span> <span class="fl">100</span>, nbr.doses <span class="op">=</span> <span class="fl">2</span>, dosing.interval <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">ev</span><span class="op">$</span><span class="fu">add.sampling</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">sim_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">rxModel_true</span>, events <span class="op">=</span> <span class="va">ev</span>, cores <span class="op">=</span> <span class="fl">0</span>, nSub <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">sim_covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">rxModel_covar</span>, events <span class="op">=</span> <span class="va">ev</span>, cores <span class="op">=</span> <span class="fl">0</span>, nSub <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">sim_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">rxModel_var</span>, events <span class="op">=</span> <span class="va">ev</span>, cores <span class="op">=</span> <span class="fl">0</span>, nSub <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the confidence intervals with a label for the model</span></span>
<span><span class="va">ci_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim_true</span>, <span class="st">"cp"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"True parameters"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## summarizing data...done</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim_covar</span>, <span class="st">"cp"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"Covariance fit"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## summarizing data...done</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim_var</span>, <span class="st">"cp"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"Variance fit"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## summarizing data...done</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bind them together</span></span>
<span><span class="va">ci_true_covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ci_true</span>, <span class="va">ci_covar</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    p1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Percentile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Percentile</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Percentile</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ci_true_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ci_true</span>, <span class="va">ci_var</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    p1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Percentile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Percentile</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Percentile</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot both models</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ci_true_covar</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Model</span>, <span class="va">Percentile</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">p2.5</span>, ymax <span class="op">=</span> <span class="va">p97.5</span>, fill <span class="op">=</span> <span class="va">Model</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">p50</span>, colour <span class="op">=</span> <span class="va">Model</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Central Concentration Simulations"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Central Concentration (mg/L)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True parameters"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                                 <span class="st">"Covariance fit"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True parameters"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                               <span class="st">"Covariance fit"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="variance_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ci_true_var</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Model</span>, <span class="va">Percentile</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">p2.5</span>, ymax <span class="op">=</span> <span class="va">p97.5</span>, fill <span class="op">=</span> <span class="va">Model</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">p50</span>, colour <span class="op">=</span> <span class="va">Model</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Central Concentration Simulations"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Central Concentration (mg/L)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True parameters"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                                 <span class="st">"Variance fit"</span> <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True parameters"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                                 <span class="st">"Variance fit"</span> <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variance_files/figure-html/unnamed-chunk-13-2.png" width="700">
Both models capture the central tendency of the true parameters dynamics
well. However, the variance only model shows slightly wider population
intervals. In this scenario this isn’t very problematic, since a wider
range still captures the true dynamics. However, in other scenarios,
this could lead to over- or under-prediction of certain percentiles. The
estimation error is expected due to the reduced information content in
variance-only data.</p>
</div>
</div>
<div class="section level3">
<h3 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h3>
<p>So to recap, here are some best practices for variance-based (but
also covariance-based) modeling with <code>admr</code>:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Data Preparation</strong>:
<ul>
<li>Always check your data for missing values and outliers</li>
<li>Ensure time points are consistent across subjects</li>
<li>Consider the impact of dosing events on your analysis</li>
</ul>
</li>
<li>
<strong>Model Specification</strong>:
<ul>
<li>Start with a simple model and gradually add complexity</li>
<li>Use meaningful initial values for parameters</li>
<li>Consider parameter transformations for better estimation</li>
</ul>
</li>
<li>
<strong>Model Fitting</strong>:
<ul>
<li>Use multiple chains to improve optimization</li>
<li>Monitor convergence carefully</li>
<li>Check parameter estimates for biological plausibility</li>
</ul>
</li>
<li>
<strong>Diagnostics</strong>:
<ul>
<li>Always examine convergence plots</li>
<li>Validate model predictions against observed data</li>
</ul>
</li>
</ol>
<p>For more information, see the package documentation and other
vignettes.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by H. van de Beek, P.A.J. Välitalo, L.B. Zwep, J.G.C. van Hasselt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
