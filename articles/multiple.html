<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Combining multiple datasets with admr • admr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Combining multiple datasets with admr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/admr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/examplomycin.html">Examplomycin dataset: a pharmacokinetic example</a></li>
    <li><a class="dropdown-item" href="../articles/multiple.html">Combining multiple datasets with admr</a></li>
    <li><a class="dropdown-item" href="../articles/variance.html">Variance-only based modelling with admr</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/vanhasseltlab/admr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Combining multiple datasets with admr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vanhasseltlab/admr/blob/master/vignettes/multiple.Rmd" class="external-link"><code>vignettes/multiple.Rmd</code></a></small>
      <div class="d-none name"><code>multiple.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-aggregate-data-modeling-with-admr">Introduction to Aggregate Data Modeling with <code>admr</code><a class="anchor" aria-label="anchor" href="#introduction-to-aggregate-data-modeling-with-admr"></a>
</h2>
<p>This vignette provides an introduction to using multiple datasets
with the <code>admr</code> package in R. This is an example how to
combine different datasets with non-overlapping timepoints. However, the
same principles can be applied to datasets with overlapping timepoints;
or even datasets with different dosing regimens. Therefore, this
vignette can be used as a guide for meta-analysis of pharmacokinetic
data. Further research is currently being conducted to validate this
approach for meta-analysis or model averaging.</p>
<div class="section level3">
<h3 id="required-packages">Required Packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>First, ensure you have the necessary packages loaded:</p>
<details><summary>
Click here
</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vanhasseltlab.github.io/admr">admr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/rxode2/" class="external-link">rxode2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.org/" class="external-link">nlmixr2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mnorm</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>  <span class="co"># For visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-quantities.github.io/units/" class="external-link">units</a></span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="understanding-the-data-format">Understanding the Data Format<a class="anchor" aria-label="anchor" href="#understanding-the-data-format"></a>
</h3>
<p>The <code>admr</code> package works with two types of data
formats:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Raw Data</strong>: Individual-level observations in a wide
or long format.</li>
<li>
<strong>Aggregate Data</strong>: Summary statistics (mean and
covariance) computed from raw data.</li>
<li>
<strong>Aggregate Data with only means and variance</strong>: Mean
and variance for each time point (no covariances).</li>
</ol>
<p>The vignette <a href="https://vanhasseltlab.github.io/admr/articles/variance.html">Variance-only
based modelling</a> provides more details on the third option.</p>
<p>Let’s look at the simulated examplomycin dataset, which we’ll use
throughout this vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    ID TIME    DV AMT EVID CMT</span></span>
<span><span class="co">## 1 460 0.00 0.000 100  101   1</span></span>
<span><span class="co">## 2 460 0.10 0.752   0    0   2</span></span>
<span><span class="co">## 3 460 0.25 1.932   0    0   2</span></span>
<span><span class="co">## 4 460 0.50 3.694   0    0   2</span></span>
<span><span class="co">## 5 460 1.00 3.479   0    0   2</span></span>
<span><span class="co">## 6 460 2.00 4.003   0    0   2</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basic dataset information</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of subjects:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of subjects: 500</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of time points:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">$</span><span class="va">TIME</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of time points: 10</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Time points:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">examplomycin</span><span class="op">$</span><span class="va">TIME</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Time points: 0, 0.1, 0.25, 0.5, 1, 2, 3, 5, 8, 12</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<div class="section level4">
<h4 id="converting-raw-data-to-aggregate-format">Converting Raw Data to Aggregate Format<a class="anchor" aria-label="anchor" href="#converting-raw-data-to-aggregate-format"></a>
</h4>
<p>The first step is to convert our simulated raw data into aggregate
format. In real-world scenarios, you might have to extract summary
statistics from published studies, depending on the available
information. But for this example, we’ll compute the mean and covariance
from the <code>examplomycin</code> dataset. Here’s how to do it:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to wide format</span></span>
<span><span class="va">examplomycin_wide</span> <span class="op">&lt;-</span> <span class="va">examplomycin</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">EVID</span> <span class="op">!=</span> <span class="fl">101</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># Remove dosing events</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">TIME</span>, <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># Select relevant columns</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">TIME</span>, values_from <span class="op">=</span> <span class="va">DV</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># Convert to wide format</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Remove ID column</span></span></code></pre></div>
<p>To illustrate the use of multiple datasets, we’ll split the data into
two groups based on timepoints: one group with timepoints 0.1, 0.25,
0.5, and 1 hour; and another group with timepoints 2, 3, 5, 8, and 12
hours. This illustrates how to use a dataset with absorption phase data
and a dataset with elimination phase data. We will then create
aggregated data for each group separately:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create aggregated data and filter timepoints 1 to 4</span></span>
<span><span class="va">examplomycin_aggregated1</span> <span class="op">&lt;-</span> <span class="va">examplomycin_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/meancov.html">meancov</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">examplomycin_aggregated2</span> <span class="op">&lt;-</span> <span class="va">examplomycin_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/meancov.html">meancov</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># View the structure of aggregated data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">examplomycin_aggregated1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ E: Named num [1:4] 0.966 1.939 2.788 3.025</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:4] "0.1" "0.25" "0.5" "1"</span></span>
<span><span class="co">##  $ V: num [1:4, 1:4] 0.21 0.308 0.349 0.203 0.308 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:4] "0.1" "0.25" "0.5" "1"</span></span>
<span><span class="co">##   .. ..$ : chr [1:4] "0.1" "0.25" "0.5" "1"</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">examplomycin_aggregated2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ E: Named num [1:5] 2.258 1.651 1.063 0.751 0.512</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:5] "2" "3" "5" "8" ...</span></span>
<span><span class="co">##  $ V: num [1:5, 1:5] 0.3447 0.1203 0.0764 0.064 0.0494 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:5] "2" "3" "5" "8" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:5] "2" "3" "5" "8" ...</span></span></code></pre>
<p>Compared to the full aggregated dataset, each of these datasets
contains only a subset of the timepoints. This means covariances between
timepoints in different datasets are not available, effectively reducing
the information content. However, the <code>admr</code> package can
still handle this situation effectively.</p>
</div>
<div class="section level4">
<h4 id="visualizing-the-data">Visualizing the Data<a class="anchor" aria-label="anchor" href="#visualizing-the-data"></a>
</h4>
<p>Before fitting the model, it’s helpful to visualize the data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Give different colours to 1-4 and 5-9</span></span>
<span><span class="va">examplomycin</span> <span class="op">&lt;-</span> <span class="fu">admr</span><span class="fu">::</span><span class="va"><a href="../reference/examplomycin.html">examplomycin</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">EVID</span> <span class="op">!=</span> <span class="fl">101</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># Remove dosing events</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TIME <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">TIME</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">TIME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"Absorption"</span>, <span class="st">"Elimination"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">examplomycin</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">TIME</span>, y <span class="op">=</span> <span class="va">DV</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Examplomycin Concentration Data"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time (hours)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Concentration (mg/L)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Absorption"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"Elimination"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="multiple_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="model-specification">Model Specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h3>
<div class="section level4">
<h4 id="defining-the-pharmacokinetic-model">Defining the Pharmacokinetic Model<a class="anchor" aria-label="anchor" href="#defining-the-pharmacokinetic-model"></a>
</h4>
<p>We’ll use a two-compartment model with first-order absorption. We use
a solved model approach for simplicity. The model parameters
include:</p>
<details><summary>
Click here
</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rxModel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">cp</span> <span class="op">=</span> <span class="fu">linCmt</span><span class="op">(</span></span>
<span>    <span class="va">cl</span>,           <span class="co"># Clearance</span></span>
<span>    <span class="va">v1</span>,           <span class="co"># Volume of central compartment</span></span>
<span>    <span class="va">v2</span>,           <span class="co"># Volume of peripheral compartment</span></span>
<span>    <span class="va">q</span>,            <span class="co"># Inter-compartmental clearance</span></span>
<span>    <span class="va">ka</span>            <span class="co"># Absorption rate constant</span></span>
<span>  <span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rxModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxode2.html" class="external-link">rxode2</a></span><span class="op">(</span><span class="va">rxModel</span><span class="op">)</span></span>
<span><span class="va">rxModel</span> <span class="op">&lt;-</span> <span class="va">rxModel</span><span class="op">$</span><span class="va">simulationModel</span></span></code></pre></div>
</details>
</div>
<div class="section level4">
<h4 id="creating-the-prediction-function">Creating the Prediction Function<a class="anchor" aria-label="anchor" href="#creating-the-prediction-function"></a>
</h4>
<p>The prediction function is crucial for the <code>admr</code> package.
It: - Constructs the event table for dosing and sampling - Solves the
RxODE model - Returns predicted concentrations in the required
format</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rxode2</span><span class="fu">::</span><span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSetSilentErr.html" class="external-link">rxSetSilentErr</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predder</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">theta_i</span>, <span class="va">dose</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n_individuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">theta_i</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">n_individuals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">n_individuals</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Create event table</span></span>
<span>    <span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/eventTable.html" class="external-link">eventTable</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span></span>
<span>    <span class="va">ev</span><span class="op">$</span><span class="fu">add.dosing</span><span class="op">(</span>dose <span class="op">=</span> <span class="va">dose</span>, nbr.doses <span class="op">=</span> <span class="fl">1</span>, start.time <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">ev</span><span class="op">$</span><span class="fu">add.sampling</span><span class="op">(</span><span class="va">time</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Solve model</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">rxModel</span>, params <span class="op">=</span> <span class="va">theta_i</span>, events <span class="op">=</span> <span class="va">ev</span>, cores <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Format output</span></span>
<span>    <span class="va">cp_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">cp</span>, nrow <span class="op">=</span> <span class="va">n_individuals</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, </span>
<span>                        byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cp_matrix</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Since both datasets come from the same study design, we can use the
same prediction function for both datasets. However, if the datasets had
different dosing regimens or other characteristics, you would need to
define separate prediction functions for each dataset. This can be done
by creating multiple <code>genopts</code> objects, each with its own
prediction function.</p>
</div>
</div>
<div class="section level3">
<h3 id="model-fitting">Model Fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<div class="section level4">
<h4 id="setting-up-model-options">Setting Up Model Options<a class="anchor" aria-label="anchor" href="#setting-up-model-options"></a>
</h4>
<p>The <code>genopts</code> function creates an options object that
controls the model fitting process:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opts1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genopts.html">genopts</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Observation times</span></span>
<span>  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="fl">5</span>, v1 <span class="op">=</span> <span class="fl">10</span>, v2 <span class="op">=</span> <span class="fl">30</span>, q <span class="op">=</span> <span class="fl">10</span>, ka <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Population parameters</span></span>
<span>    Omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,  <span class="co"># Random effects</span></span>
<span>    Sigma_prop <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Proportional error</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10000</span>,  <span class="co"># Number of Monte Carlo samples</span></span>
<span>  n <span class="op">=</span> <span class="fl">500</span>,      <span class="co"># Number of individuals</span></span>
<span>  fo_appr <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Disable first-order approximation</span></span>
<span>  omega_expansion <span class="op">=</span> <span class="fl">1</span>,  <span class="co"># Omega expansion factor</span></span>
<span>  f <span class="op">=</span> <span class="va">predder</span>    <span class="co"># Prediction function</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">opts2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genopts.html">genopts</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">12</span><span class="op">)</span>,  <span class="co"># Observation times</span></span>
<span>  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="fl">5</span>, v1 <span class="op">=</span> <span class="fl">10</span>, v2 <span class="op">=</span> <span class="fl">30</span>, q <span class="op">=</span> <span class="fl">10</span>, ka <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Population parameters</span></span>
<span>    Omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.09</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,  <span class="co"># Random effects</span></span>
<span>    Sigma_prop <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Proportional error</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10000</span>,  <span class="co"># Number of Monte Carlo samples</span></span>
<span>  n <span class="op">=</span> <span class="fl">500</span>,      <span class="co"># Number of individuals</span></span>
<span>  fo_appr <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Disable first-order approximation</span></span>
<span>  omega_expansion <span class="op">=</span> <span class="fl">1</span>,  <span class="co"># Omega expansion factor</span></span>
<span>  f <span class="op">=</span> <span class="va">predder</span>    <span class="co"># Prediction function</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The difference between <code>opts1</code> and <code>opts2</code> is
the observation times specified in the <code>time</code> argument.</p>
</div>
<div class="section level4">
<h4 id="fitting-the-model">Fitting the Model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h4>
<p>Before fitting the model, ensure the <code>opts</code> objects and
aggregated datasets are organized into lists. The <code>fitIRMC</code>
function fits the model using the IR-MC algorithm:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">opts1</span>,<span class="va">opts2</span><span class="op">)</span></span>
<span><span class="va">examplomycin_aggregated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">examplomycin_aggregated1</span>, <span class="va">examplomycin_aggregated2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit.admr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitIRMC.html">fitIRMC</a></span><span class="op">(</span></span>
<span>  opts <span class="op">=</span> <span class="va">opts</span>,</span>
<span>  obs <span class="op">=</span> <span class="va">examplomycin_aggregated</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>,  <span class="co"># Number of parallel chains</span></span>
<span>  maxiter <span class="op">=</span> <span class="fl">2000</span>,  <span class="co"># Maximum iterations</span></span>
<span>  single_dataframe <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Use separate data frames for each dataset</span></span>
<span>  use_grad <span class="op">=</span> <span class="cn">TRUE</span>  </span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Chain 1:</span></span>
<span><span class="co">## Iter | NLL and Parameters (11 values)</span></span>
<span><span class="co">## --------------------------------------------------------------------------------</span></span>
<span><span class="co">##    1: -1790.659    1.609    2.303    3.401    2.303    0.000   -2.408   -2.408   -2.408   -2.408   -2.408   -3.219</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Wide Search Phase ###</span></span>
<span><span class="co">##    2: -1796.419    1.603    2.326    3.393    2.286    0.032   -2.265   -2.052   -2.306   -2.267   -2.565   -3.235</span></span>
<span><span class="co">##    3: -1796.484    1.602    2.305    3.401    2.284    0.013   -2.271   -2.106   -2.324   -2.308   -2.509   -3.235</span></span>
<span><span class="co">##    4: -1796.484    1.602    2.305    3.401    2.284    0.013   -2.271   -2.105   -2.324   -2.307   -2.509   -3.235</span></span>
<span><span class="co">##    5: -1796.484    1.602    2.305    3.401    2.284    0.013   -2.271   -2.105   -2.325   -2.307   -2.509   -3.235</span></span>
<span><span class="co">##    6: -1796.484    1.602    2.305    3.401    2.284    0.013   -2.271   -2.105   -2.325   -2.307   -2.509   -3.235</span></span>
<span><span class="co">##    7: -1796.484    1.602    2.305    3.400    2.284    0.013   -2.271   -2.105   -2.325   -2.307   -2.509   -3.235</span></span>
<span><span class="co">##    8: -1796.484    1.602    2.305    3.400    2.284    0.013   -2.271   -2.105   -2.325   -2.307   -2.509   -3.235</span></span>
<span><span class="co">##    9: -1796.484    1.602    2.305    3.400    2.284    0.013   -2.271   -2.105   -2.325   -2.307   -2.509   -3.235</span></span>
<span><span class="co">##   10: -1796.484    1.602    2.305    3.400    2.284    0.013   -2.271   -2.105   -2.325   -2.307   -2.509   -3.235</span></span>
<span><span class="co">##   11: -1796.484    1.602    2.305    3.400    2.284    0.013   -2.271   -2.105   -2.325   -2.306   -2.509   -3.235</span></span>
<span><span class="co">##   12: -1796.484    1.602    2.305    3.400    2.284    0.013   -2.271   -2.105   -2.325   -2.306   -2.509   -3.235</span></span>
<span><span class="co">## Phase Wide Search Phase converged at iteration 12.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Focussed Search Phase ###</span></span>
<span><span class="co">##   13: -1796.484    1.602    2.305    3.400    2.284    0.013   -2.271   -2.105   -2.325   -2.306   -2.509   -3.235</span></span>
<span><span class="co">##   14: -1796.484    1.602    2.305    3.400    2.284    0.013   -2.271   -2.105   -2.325   -2.306   -2.509   -3.235</span></span>
<span><span class="co">## Phase Focussed Search Phase converged at iteration 14.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Fine-Tuning Phase ###</span></span>
<span><span class="co">##   15: -1796.484    1.602    2.305    3.400    2.284    0.013   -2.271   -2.105   -2.325   -2.306   -2.509   -3.235</span></span>
<span><span class="co">##   16: -1796.484    1.602    2.305    3.400    2.284    0.014   -2.271   -2.105   -2.326   -2.306   -2.508   -3.235</span></span>
<span><span class="co">## Phase Fine-Tuning Phase converged at iteration 16.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ### Precision Phase ###</span></span>
<span><span class="co">##   17: -1796.484    1.602    2.305    3.400    2.284    0.014   -2.271   -2.105   -2.326   -2.306   -2.508   -3.235</span></span>
<span><span class="co">##   18: -1796.484    1.602    2.305    3.400    2.284    0.014   -2.271   -2.105   -2.326   -2.305   -2.508   -3.235</span></span>
<span><span class="co">##   19: -1796.484    1.602    2.306    3.400    2.284    0.014   -2.271   -2.105   -2.326   -2.305   -2.508   -3.235</span></span>
<span><span class="co">##   20: -1796.484    1.602    2.306    3.400    2.284    0.014   -2.271   -2.105   -2.326   -2.305   -2.508   -3.235</span></span>
<span><span class="co">##   21: -1796.484    1.602    2.306    3.400    2.284    0.014   -2.271   -2.105   -2.326   -2.305   -2.508   -3.235</span></span>
<span><span class="co">##   22: -1796.484    1.602    2.306    3.400    2.285    0.014   -2.271   -2.105   -2.326   -2.305   -2.508   -3.235</span></span>
<span><span class="co">## Phase Precision Phase converged at iteration 22.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 Complete: Final NLL = -1796.484, Time Elapsed = 23.35 seconds</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Phase Wide Search Phase converged at iteration 18.</span></span>
<span><span class="co">## Phase Focussed Search Phase converged at iteration 21.</span></span>
<span><span class="co">## Phase Fine-Tuning Phase converged at iteration 22.</span></span>
<span><span class="co">## Phase Precision Phase converged at iteration 23.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 2 Complete: Final NLL = -1796.484, Time Elapsed = 27.78 seconds</span></span>
<span><span class="co">## </span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="model-diagnostics">Model Diagnostics<a class="anchor" aria-label="anchor" href="#model-diagnostics"></a>
</h3>
<div class="section level4">
<h4 id="basic-diagnostics">Basic Diagnostics<a class="anchor" aria-label="anchor" href="#basic-diagnostics"></a>
</h4>
<p>The <code>print</code> method provides a summary of the model
fit:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit.admr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## -- FitIRMC Summary --</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Objective Function and Information Criteria --</span></span>
<span><span class="co">##  Log-likelihood: -1796.4841</span></span>
<span><span class="co">##             AIC: 3603.97</span></span>
<span><span class="co">##             BIC: 3729.69</span></span>
<span><span class="co">## Condition#(Cov): 165.32</span></span>
<span><span class="co">## Condition#(Cor): 271.29</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Timing Information --</span></span>
<span><span class="co">##      Best Chain: 23.3462 seconds</span></span>
<span><span class="co">##      All Chains: 51.1295 seconds</span></span>
<span><span class="co">##      Covariance: 39.2481 seconds</span></span>
<span><span class="co">##         Elapsed: 90.38 seconds</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Population Parameters --</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">##   Parameter        Est.      SE  `%RSE` `Back-transformed(95%CI)` `BSV(CV%)`</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> cl             1.60    0.015<span style="text-decoration: underline;">5</span>   0.971 4.96 (4.81, 5.12)               32.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> v1             2.31    0.094<span style="text-decoration: underline;">4</span>   4.10  10.03 (8.34, 12.07)             34.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> v2             3.40    0.043<span style="text-decoration: underline;">9</span>   1.29  29.97 (27.50, 32.66)            31.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> q              2.28    0.020<span style="text-decoration: underline;">6</span>   0.903 9.82 (9.43, 10.23)              31.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> ka             0.013<span style="text-decoration: underline;">8</span>  0.089<span style="text-decoration: underline;">7</span> 651.    1.01 (0.85, 1.21)               28.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Residual Error 0.039<span style="text-decoration: underline;">3</span> <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>     0.0393                          <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -- Iteration Diagnostics --</span></span>
<span><span class="co">##  Iter | NLL and Parameters</span></span>
<span><span class="co">## --------------------------------------------------------------------------------</span></span>
<span><span class="co">##    1: -1790.659 1.609 2.303 3.401 2.303 0.000 -2.408 -2.408 -2.408 -2.408 -2.408 -3.219</span></span>
<span><span class="co">##    2: -1796.419 1.603 2.326 3.393 2.286 0.032 -2.265 -2.052 -2.306 -2.267 -2.565 -3.235</span></span>
<span><span class="co">##    3: -1796.484 1.602 2.305 3.401 2.284 0.013 -2.271 -2.106 -2.324 -2.308 -2.509 -3.235</span></span>
<span><span class="co">##    4: -1796.484 1.602 2.305 3.401 2.284 0.013 -2.271 -2.105 -2.324 -2.307 -2.509 -3.235</span></span>
<span><span class="co">##    5: -1796.484 1.602 2.305 3.401 2.284 0.013 -2.271 -2.105 -2.325 -2.307 -2.509 -3.235</span></span>
<span><span class="co">##    ... (omitted iterations) ...</span></span>
<span><span class="co">##   18: -1796.484 1.602 2.305 3.400 2.284 0.014 -2.271 -2.105 -2.326 -2.305 -2.508 -3.235</span></span>
<span><span class="co">##   19: -1796.484 1.602 2.306 3.400 2.284 0.014 -2.271 -2.105 -2.326 -2.305 -2.508 -3.235</span></span>
<span><span class="co">##   20: -1796.484 1.602 2.306 3.400 2.284 0.014 -2.271 -2.105 -2.326 -2.305 -2.508 -3.235</span></span>
<span><span class="co">##   21: -1796.484 1.602 2.306 3.400 2.284 0.014 -2.271 -2.105 -2.326 -2.305 -2.508 -3.235</span></span>
<span><span class="co">##   22: -1796.484 1.602 2.306 3.400 2.285 0.014 -2.271 -2.105 -2.326 -2.305 -2.508 -3.235</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="convergence-assessment">Convergence Assessment<a class="anchor" aria-label="anchor" href="#convergence-assessment"></a>
</h4>
<p>The <code>plot</code> method visualizes the convergence of the model
fit:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.admr</span><span class="op">)</span></span></code></pre></div>
<p><img src="multiple_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="700"><img src="multiple_files/figure-html/unnamed-chunk-10-2.png" class="r-plt" alt="" width="700"><img src="multiple_files/figure-html/unnamed-chunk-10-3.png" class="r-plt" alt="" width="700"><img src="multiple_files/figure-html/unnamed-chunk-10-4.png" class="r-plt" alt="" width="700"><img src="multiple_files/figure-html/unnamed-chunk-10-5.png" class="r-plt" alt="" width="700"><img src="multiple_files/figure-html/unnamed-chunk-10-6.png" class="r-plt" alt="" width="700"><img src="multiple_files/figure-html/unnamed-chunk-10-7.png" class="r-plt" alt="" width="700"><img src="multiple_files/figure-html/unnamed-chunk-10-8.png" class="r-plt" alt="" width="700">
Upon inspection of the convergence plots, you should look for: good
chain convergence, overlapping predicted and observed summary plots, and
similar final observed vs predicted matrices for mean and covariance. We
observe that the chains converge well, and the predicted means and
covariances align closely with the observed data.</p>
</div>
<div class="section level4">
<h4 id="parameter-estimates">Parameter Estimates<a class="anchor" aria-label="anchor" href="#parameter-estimates"></a>
</h4>
<p>Let’s examine the parameter estimates and the true values used in the
simulation. We expect to be close to the true values, although, like
discussed earlier, the estimates may be less precise due to the reduced
information content from splitting the data:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># True parameter values</span></span>
<span><span class="va">params.true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="fl">5</span>, v1 <span class="op">=</span> <span class="fl">10</span>, v2 <span class="op">=</span> <span class="fl">30</span>, q <span class="op">=</span> <span class="fl">10</span>, ka <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  Omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Sigma_prop <span class="op">=</span> <span class="fl">0.04</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"True parameter values:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## True parameter values:</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">params.true</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $beta</span></span>
<span><span class="co">## cl v1 v2  q ka </span></span>
<span><span class="co">##  5 10 30 10  1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Omega</span></span>
<span><span class="co">##      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">## [1,] 0.09 0.00 0.00 0.00 0.00</span></span>
<span><span class="co">## [2,] 0.00 0.09 0.00 0.00 0.00</span></span>
<span><span class="co">## [3,] 0.00 0.00 0.09 0.00 0.00</span></span>
<span><span class="co">## [4,] 0.00 0.00 0.00 0.09 0.00</span></span>
<span><span class="co">## [5,] 0.00 0.00 0.00 0.00 0.09</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Sigma_prop</span></span>
<span><span class="co">## [1] 0.04</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract parameter estimates</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="va">fit.admr</span><span class="op">$</span><span class="va">transformed_params</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Final parameter estimates:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Final parameter estimates:</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $beta</span></span>
<span><span class="co">##        cl        v1        v2         q        ka </span></span>
<span><span class="co">##  4.962124 10.030806 29.970361  9.821153  1.013878 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Omega</span></span>
<span><span class="co">##           [,1]      [,2]       [,3]     [,4]       [,5]</span></span>
<span><span class="co">## [1,] 0.1031999 0.0000000 0.00000000 0.000000 0.00000000</span></span>
<span><span class="co">## [2,] 0.0000000 0.1217946 0.00000000 0.000000 0.00000000</span></span>
<span><span class="co">## [3,] 0.0000000 0.0000000 0.09766634 0.000000 0.00000000</span></span>
<span><span class="co">## [4,] 0.0000000 0.0000000 0.00000000 0.099783 0.00000000</span></span>
<span><span class="co">## [5,] 0.0000000 0.0000000 0.00000000 0.000000 0.08141121</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Sigma_prop</span></span>
<span><span class="co">## [1] 0.03934987</span></span></code></pre>
<p>We observe that the parameter estimates are reasonably close to the
true values, especially considering the reduced information content from
splitting the data into two groups. There are some deviations,
particularly in the estimates of <code>q</code> and the random effect of
<code>v1</code>, which may be attributed to the lack of early timepoint
data in the second dataset. Let’s also visualize the dynamics of the
estimated model together with the true model through a dosing
simulation. ## Advanced Features</p>
</div>
<div class="section level4">
<h4 id="creating-a-dosing-plot">Creating a dosing plot<a class="anchor" aria-label="anchor" href="#creating-a-dosing-plot"></a>
</h4>
<p>To visualize the dosing regimen and predicted concentrations, we can
create a dosing plot. This helps in understanding the pharmacokinetic
profile of the drug over time. This can be done using the
<code>nlmixr2</code>-universe. First, we need to define the model in
<code>nlmixr2</code> syntax and then simulate the dosing regimen of both
the estimated and true models.</p>
<details><summary>
Click here
</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params.true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="fl">5</span>, v1 <span class="op">=</span> <span class="fl">10</span>, v2 <span class="op">=</span> <span class="fl">30</span>, q <span class="op">=</span> <span class="fl">10</span>, ka <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  Omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Sigma_prop <span class="op">=</span> <span class="fl">0.04</span></span>
<span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="va">fit.admr</span><span class="op">$</span><span class="va">transformed_params</span></span>
<span></span>
<span><span class="va">rxModel_true</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"cl"</span><span class="op">]</span>  <span class="co"># Clearance</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v1"</span><span class="op">]</span>  <span class="co"># Volume of central compartment</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v2"</span><span class="op">]</span> <span class="co"># Volume of peripheral compartment</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"q"</span><span class="op">]</span>    <span class="co"># Inter-compartmental clearance</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">params.true</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"ka"</span><span class="op">]</span>   <span class="co"># Absorption rate constant</span></span>
<span></span>
<span>    <span class="va">eta_cl</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">eta_v1</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">eta_v2</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">eta_q</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">]</span></span>
<span>    <span class="va">eta_ka</span> <span class="op">~</span> <span class="va">params.true</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">cl</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_cl</span><span class="op">)</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">v1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v1</span><span class="op">)</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">v2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v2</span><span class="op">)</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_q</span><span class="op">)</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">ka</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_ka</span><span class="op">)</span></span>
<span>    <span class="va">cp</span> <span class="op">=</span> <span class="fu">linCmt</span><span class="op">(</span><span class="va">cl</span>, <span class="va">v1</span>, <span class="va">v2</span>, <span class="va">q</span>, <span class="va">ka</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rxModel_multiple</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/ini.html" class="external-link">ini</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"cl"</span><span class="op">]</span>  <span class="co"># Clearance</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v1"</span><span class="op">]</span>  <span class="co"># Volume of central compartment</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"v2"</span><span class="op">]</span> <span class="co"># Volume of peripheral compartment</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"q"</span><span class="op">]</span>    <span class="co"># Inter-compartmental clearance</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="st">"ka"</span><span class="op">]</span>   <span class="co"># Absorption rate constant</span></span>
<span></span>
<span>    <span class="va">eta_cl</span> <span class="op">~</span> <span class="va">params</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">eta_v1</span> <span class="op">~</span> <span class="va">params</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">eta_v2</span> <span class="op">~</span> <span class="va">params</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="va">eta_q</span> <span class="op">~</span> <span class="va">params</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">]</span></span>
<span>    <span class="va">eta_ka</span> <span class="op">~</span> <span class="va">params</span><span class="op">$</span><span class="va">Omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">cl</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_cl</span><span class="op">)</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">v1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v1</span><span class="op">)</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">v2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_v2</span><span class="op">)</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_q</span><span class="op">)</span></span>
<span>    <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">ka</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta_ka</span><span class="op">)</span></span>
<span>    <span class="va">cp</span> <span class="op">=</span> <span class="fu">linCmt</span><span class="op">(</span><span class="va">cl</span>, <span class="va">v1</span>, <span class="va">v2</span>, <span class="va">q</span>, <span class="va">ka</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rxModel_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxode2.html" class="external-link">rxode2</a></span><span class="op">(</span><span class="fu">rxModel_true</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rxModel_true</span> <span class="op">&lt;-</span> <span class="va">rxModel_true</span><span class="op">$</span><span class="va">simulationModel</span></span>
<span><span class="va">rxModel_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxode2.html" class="external-link">rxode2</a></span><span class="op">(</span><span class="fu">rxModel_multiple</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rxModel_multiple</span> <span class="op">&lt;-</span> <span class="va">rxModel_multiple</span><span class="op">$</span><span class="va">simulationModel</span></span></code></pre></div>
</details><p>Now that we have defined both models, we can simulate the dosing
regimen and plot the results:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>  <span class="co"># Dense time points for smooth curves</span></span>
<span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/eventTable.html" class="external-link">eventTable</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span></span>
<span><span class="va">ev</span><span class="op">$</span><span class="fu">add.dosing</span><span class="op">(</span>dose <span class="op">=</span> <span class="fl">100</span>, nbr.doses <span class="op">=</span> <span class="fl">2</span>, dosing.interval <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">ev</span><span class="op">$</span><span class="fu">add.sampling</span><span class="op">(</span><span class="va">time_points</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">rxModel_true</span>, events <span class="op">=</span> <span class="va">ev</span>, cores <span class="op">=</span> <span class="fl">0</span>, nSub <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">sim_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">rxModel_multiple</span>, events <span class="op">=</span> <span class="va">ev</span>, cores <span class="op">=</span> <span class="fl">0</span>, nSub <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the confidence intervals with a label for the model</span></span>
<span><span class="va">ci_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim_true</span>, <span class="st">"cp"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"True parameters"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## summarizing data...done</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim_multiple</span>, <span class="st">"cp"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"Estimated model"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## summarizing data...done</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bind them together</span></span>
<span><span class="va">ci_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ci_true</span>, <span class="va">ci_covar</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    p1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Percentile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Percentile</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Percentile</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot both models</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ci_all</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Model</span>, <span class="va">Percentile</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">p2.5</span>, ymax <span class="op">=</span> <span class="va">p97.5</span>, fill <span class="op">=</span> <span class="va">Model</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">p50</span>, colour <span class="op">=</span> <span class="va">Model</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Central Concentration Simulations"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Central Concentration (mg/L)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True parameters"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                                 <span class="st">"Estimated model"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True parameters"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>                               <span class="st">"Estimated model"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once per session.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="multiple_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" alt="" width="700"></p>
<p>The combined dataset model (red) closely follows the true parameter
model (blue). The median line of the estimated model almost perfectly
overlaps with the true model, indicating that the estimated model.
However, the estimated model does show slightly wider population
intervals. In this scenario this isn’t very problematic, since a wider
range still captures the true dynamics. In case of dose optimization,
this results in a more conservative dose recommendation. However, in
other scenarios, this could lead to over- or under-prediction of certain
percentiles. The estimation error is expected due to the reduced
information content in variance-only data.</p>
</div>
</div>
<div class="section level3">
<h3 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h3>
<p>So to conclude, here are some best practices when using the
<code>admr</code> package for aggregate data modeling:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Data Preparation</strong>:
<ul>
<li>Always check your data for missing values and outliers</li>
<li>Ensure time points are consistent across subjects</li>
<li>Consider the impact of dosing events on your analysis</li>
</ul>
</li>
<li>
<strong>Model Specification</strong>:
<ul>
<li>Start with a simple model and gradually add complexity</li>
<li>Use meaningful initial values for parameters</li>
<li>Consider parameter transformations for better estimation</li>
</ul>
</li>
<li>
<strong>Model Fitting</strong>:
<ul>
<li>Use multiple chains to improve optimization</li>
<li>Monitor convergence carefully</li>
<li>Check parameter estimates for biological plausibility</li>
</ul>
</li>
<li>
<strong>Diagnostics</strong>:
<ul>
<li>Always examine convergence plots</li>
<li>Validate model predictions against observed data</li>
</ul>
</li>
</ol>
<p>For more information, see the package documentation and other
vignettes.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by H. van de Beek, P.A.J. Välitalo, L.B. Zwep, J.G.C. van Hasselt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
